


sub fastcall copper_wobble()

    asm:       
   ; push namespace CopperWobble 
    copper_wobble: 
        ld      a,2
        ; out     ($fe),a             ; red border 

        xor     a 
        ld      (._copperl),a             ; l = 0     copper line 
        ld      a,(._copperb)             
        ld      (._coppere),a             ; e = b     y delta 
        ld      (._copperx),a             ; x = b     x delta 


        ; c = 1+(peek(add+cast(uinteger,d))>>2)

        ld      hl,sindata
        ld      a,(._copperd)
        add     hl,a 
        ld      a,(hl)
        srl     a 
        srl     a 
        add     a,1 
        ld      (._copperc),a 

        ld      b,0

        cop_upload_copperloop:

        nextreg COPPER_DATA_NR_60,128           ; wait %1000 0000
        ld      a,(._copperl)
        nextreg COPPER_DATA_NR_60,a             ; line 

        ; NextRegA(COPPER_copperdATA_NR_60,128)       ' 96, 128   WAIT 
        ; NextRegA(COPPER_copperdATA_NR_60,l)         ' 96, x     WAIT VALUE 

        ; i = peek(add+cast(uinteger,x))

        ld      hl,sindata                      ; x offset 
        ld      a,(._copperx)
        add     hl,a 
        ld      a,(hl)
        ld      (._copperi),a 

        ; write x offset 
        nextreg COPPER_DATA_NR_60,LAYER2_XOFFSET_NR_16
        ld      a,(._copperi) 
        ; add     a,a 
        nextreg COPPER_DATA_NR_60,a

        ; j = peek(add+cast(uinteger,e))

        ld      hl,sindata
        ld      a,(._coppere)
        add     hl,a 
        ld      a,(hl)
        ld      (._copperj),a 

        ; write y offset 
        nextreg COPPER_DATA_NR_60,LAYER2_YOFFSET_NR_17
        ld      a,(._copperj) 
        ld      h,a 
        ld      a,(._copperc)
        srl     a 
        ;srl     a 

        add     a,h  
        ; srl     a 
        add     a,a 
        nextreg COPPER_DATA_NR_60,a

        ; inc variables 

        ld      hl,._coppere              ; e = e + 1     increase y delta 
        inc     (hl) 
        ld      hl,._copperl              ; l = l + 1     increase coppper line
        inc     (hl) 
        ld      hl,._copperx              ; x = x + 1     increase x delta 
        ; inc     (hl) 

        djnz    cop_upload_copperloop     ; repeat for all copper line s

        nextreg COPPER_DATA_NR_60,%10000001                ; 96, 98    01 100010 cc 000iii
        nextreg COPPER_DATA_NR_60,255               ; 96, 64    01 000000 
        nextreg COPPER_CONTROL_LO_NR_61,0
        nextreg COPPER_CONTROL_HI_NR_62,%11000000

        ld      hl,._coppere              ; e = e + 1     increase y delta 
        inc     (hl) 

        ld      hl,._copperd              ; d = d + 1    
        inc     (hl) 

        ld      hl,._copperc              ; b = b + c
        ld      a,(._copperb)
        add     a,(hl)
        ld      (._copperb),a 

        ;xor     a                   ; border 0 
        ;out     ($fe),a 

        ;call    wait_raster_copperline 

        ;jp      copper_wobble       ; repeat 


       wait_raster_copperline:

        ld      a,VIDEO_LINE_LSB_NR_1F
        ld      bc,TBBLUE_REGISTER_SELECT_P_243B
        out     (c),a 
        inc     b   
        in      a,(c)
        cp      192                 ; wait for line 250
        jr      z,wait_raster_copperline
        ret 
      ; pop namespace
    end asm 
end sub 

sindata:
    asm 
    sindata:
    ; 

    db 1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3
    db 3,4,4,4,4,5,5,5,6,6,6,6,7,7,7,8
    db 8,8,9,9,9,9,10,10,10,11,11,12,12,12,13,13
    db 13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18
    db 19,19,20,20,20,21,21,21,21,22,22,22,23,23,23,24
    db 24,24,24,25,25,25,26,26,26,26,27,27,27,27,27,28
    db 28,28,28,28,29,29,29,29,29,29,29,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,29,29,29,29,29
    db 29,28,28,28,28,28,27,27,27,27,27,26,26,26,26,25
    db 25,25,25,24,24,24,23,23,23,23,22,22,22,21,21,21
    db 20,20,20,19,19,19,18,18,18,17,17,16,16,16,15,15
    db 15,14,14,14,13,13,13,12,12,12,11,11,11,10,10,10
    db 9,9,9,8,8,8,7,7,7,6,6,6,6,5,5,5
    db 5,4,4,4,4,3,3,3,3,2,2,2,2,2,1,1
    db 1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0

    db 1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3
    db 3,4,4,4,4,5,5,5,6,6,6,6,7,7,7,8
    db 8,8,9,9,9,9,10,10,10,11,11,12,12,12,13,13
    db 13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18
    db 19,19,20,20,20,21,21,21,21,22,22,22,23,23,23,24
    db 24,24,24,25,25,25,26,26,26,26,27,27,27,27,27,28
    db 28,28,28,28,29,29,29,29,29,29,29,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,29,29,29,29,29
    db 29,28,28,28,28,28,27,27,27,27,27,26,26,26,26,25
    db 25,25,25,24,24,24,23,23,23,23,22,22,22,21,21,21
    db 20,20,20,19,19,19,18,18,18,17,17,16,16,16,15,15
    db 15,14,14,14,13,13,13,12,12,12,11,11,11,10,10,10
    db 9,9,9,8,8,8,7,7,7,6,6,6,6,5,5,5
    db 5,4,4,4,4,3,3,3,3,2,2,2,2,2,1,1
    db 1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0

    db 1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3
    db 3,4,4,4,4,5,5,5,6,6,6,6,7,7,7,8
    db 8,8,9,9,9,9,10,10,10,11,11,12,12,12,13,13
    db 13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18
    db 19,19,20,20,20,21,21,21,21,22,22,22,23,23,23,24
    db 24,24,24,25,25,25,26,26,26,26,27,27,27,27,27,28
    db 28,28,28,28,29,29,29,29,29,29,29,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,29,29,29,29,29
    db 29,28,28,28,28,28,27,27,27,27,27,26,26,26,26,25
    db 25,25,25,24,24,24,23,23,23,23,22,22,22,21,21,21
    db 20,20,20,19,19,19,18,18,18,17,17,16,16,16,15,15
    db 15,14,14,14,13,13,13,12,12,12,11,11,11,10,10,10
    db 9,9,9,8,8,8,7,7,7,6,6,6,6,5,5,5
    db 5,4,4,4,4,3,3,3,3,2,2,2,2,2,1,1
    db 1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0


    db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
    db 1,1,1,1,1,2,2,2,2,2,3,3,3,3,4,4
    db 4,4,5,5,5,6,6,6,6,7,7,7,8,8,8,9
    db 9,9,10,10,11,11,11,12,12,12,13,13,14,14,14,15
    db 15,15,16,16,17,17,17,18,18,19,19,19,20,20,20,21
    db 21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26
    db 26,26,27,27,27,27,28,28,28,28,28,29,29,29,29,29
    db 29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,29
    db 29,29,29,29,29,28,28,28,28,28,27,27,27,27,26,26
    db 26,26,25,25,25,24,24,24,23,23,23,22,22,22,21,21
    db 21,20,20,20,19,19,19,18,18,17,17,17,16,16,15,15
    db 15,14,14,14,13,13,12,12,12,11,11,11,10,10,9,9
    db 9,8,8,8,7,7,7,6,6,6,6,5,5,5,4,4
    db 4,4,3,3,3,3,2,2,2,2,2,1,1,1,1,1
    db 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

    db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
    db 1,1,1,1,1,2,2,2,2,2,3,3,3,3,4,4
    db 4,4,5,5,5,6,6,6,6,7,7,7,8,8,8,9
    db 9,9,10,10,11,11,11,12,12,12,13,13,14,14,14,15
    db 15,15,16,16,17,17,17,18,18,19,19,19,20,20,20,21
    db 21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26
    db 26,26,27,27,27,27,28,28,28,28,28,29,29,29,29,29
    db 29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,29
    db 29,29,29,29,29,28,28,28,28,28,27,27,27,27,26,26
    db 26,26,25,25,25,24,24,24,23,23,23,22,22,22,21,21
    db 21,20,20,20,19,19,19,18,18,17,17,17,16,16,15,15
    db 15,14,14,14,13,13,12,12,12,11,11,11,10,10,9,9
    db 9,8,8,8,7,7,7,6,6,6,6,5,5,5,4,4
    db 4,4,3,3,3,3,2,2,2,2,2,1,1,1,1,1
    db 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

    db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
    db 1,1,1,1,1,2,2,2,2,2,3,3,3,3,4,4
    db 4,4,5,5,5,6,6,6,6,7,7,7,8,8,8,9
    db 9,9,10,10,11,11,11,12,12,12,13,13,14,14,14,15
    db 15,15,16,16,17,17,17,18,18,19,19,19,20,20,20,21
    db 21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26
    db 26,26,27,27,27,27,28,28,28,28,28,29,29,29,29,29
    db 29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
    db 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,29
    db 29,29,29,29,29,28,28,28,28,28,27,27,27,27,26,26
    db 26,26,25,25,25,24,24,24,23,23,23,22,22,22,21,21
    db 21,20,20,20,19,19,19,18,18,17,17,17,16,16,15,15
    db 15,14,14,14,13,13,12,12,12,11,11,11,10,10,9,9
    db 9,8,8,8,7,7,7,6,6,6,6,5,5,5,4,4
    db 4,4,3,3,3,3,2,2,2,2,2,1,1,1,1,1
    db 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
end asm 

copper_wobble()

dim     copperx,copperi,copperb,copperl,copperc,copperd,coppere,copperj as ubyte 

border  copperx+copperi+copperb+copperl+copperc+copperd+coppere+copperj